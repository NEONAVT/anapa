<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Куда намылились — Афиша, заведения и места Анапы, Геленджика и Новороссийска</title>
  <meta name="description" content="Сайт-блог с афишей, заведениями и местами Анапы, Геленджика и Новороссийска."/>
  <meta name="color-scheme" content="light"/>
  <meta name="theme-color" content="#cc4964"/>
  <style>
    :root{
  --brand:#cc4964; --brand-rgb:204,73,100;
  --bg:#ffffff; --text:#0a0a0a; --muted:#6b7280; --border:#e5e7eb;
  --max:1120px; --radius:16px;

  --glass-blur:20px; --glass-sat:1.2; --bar-alpha:.14;
  --btn-alpha:.30; --btn-alpha-hover:.38; --btn-outer-shadow:.10;
  --stroke-alpha:.35; --shadow-alpha:.16;
  --logo-size:80px; --tg-size:22px;
}
*,*::before,*::after{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
img{max-width:100%;display:block}
a{color:inherit;text-decoration:none}
html,body{overflow-x:hidden}

/* ---------- TOPBAR (sticky) ---------- */
.topbar{position:sticky;top:0;z-index:1000;
  background:linear-gradient(180deg, rgba(var(--brand-rgb), .08), rgba(255,255,255,.04)), rgba(255,255,255,var(--bar-alpha));
  -webkit-backdrop-filter:saturate(var(--glass-sat)) blur(var(--glass-blur));
  backdrop-filter:saturate(var(--glass-sat)) blur(var(--glass-blur));
  box-shadow:inset 0 1px 0 rgba(255,255,255,.50), 0 8px 24px rgba(0,0,0,var(--shadow-alpha));
  border-bottom:1px solid rgba(255,255,255,var(--stroke-alpha));
  overflow:visible;
}
.topbar__inner{max-width:var(--max);margin:0 auto;padding:10px 16px;
  display:grid;grid-template-columns:1fr auto 1fr;grid-template-areas:"left center right";
  align-items:center;gap:12px;}
.topbar__left{grid-area:left;display:flex;align-items:center;gap:10px;justify-content:flex-start}
.topbar__center{grid-area:center;display:flex;justify-content:center}
.topbar__right{grid-area:right;display:flex;justify-content:flex-end;gap:10px;flex-wrap:wrap}

@media (max-width:768px){
  :root{ --logo-size:40px; --tg-size:16px; }
  .topbar{ position: sticky; top: 0; border-bottom:0; }
  .topbar__inner{
    grid-template-columns:auto auto;
    grid-template-areas:
      "center left"
      "right  right";
    row-gap:6px;
    padding:4px 8px 6px;
    align-items:center;
  }
  .topbar__center{ justify-content:flex-end; }
  .topbar__left{ justify-content:flex-start; }
  .topbar__right{
    justify-content:center; flex-wrap:nowrap; gap:10px;
    padding:4px 8px !important; overflow-x:auto; -webkit-overflow-scrolling:touch; scrollbar-width:none;
  }
  .topbar__right::-webkit-scrollbar{display:none}
  .glass-btn{padding:4px 8px;font-size:13px;line-height:1.1}
}

/* ---------- Buttons ---------- */
.glass-btn{
  position:relative;display:inline-flex;align-items:center;gap:8px;
  padding:9px 12px;border-radius:999px;font-weight:600;color:#0b0b0b;
  background:rgba(255,255,255,var(--btn-alpha));
  border:1px solid transparent;
  -webkit-backdrop-filter:saturate(1.1) blur(calc(var(--glass-blur)*.6));
  backdrop-filter:saturate(1.1) blur(calc(var(--glass-blur)*.6));
  box-shadow:0 6px 16px rgba(0,0,0,var(--btn-outer-shadow));
  transition:background .15s ease, transform .06s ease, box-shadow .15s ease;
  white-space:nowrap;
}
.glass-btn:hover{background:rgba(255,255,255,var(--btn-alpha-hover));box-shadow:0 8px 20px rgba(0,0,0,.12)}
.glass-btn:active{transform:translateY(1px)}
.glass-btn:focus-visible{outline:none;box-shadow:0 0 0 2px rgba(0,0,0,.06), 0 8px 20px rgba(0,0,0,.12)}
.tg-ic{width:var(--tg-size);height:var(--tg-size);flex:0 0 var(--tg-size);display:block;transform:translateY(1px)}

/* ---------- Logo ---------- */
.logo-circle{background:#fff;border-radius:50%;
  width:calc(var(--logo-size) + 2px);height:calc(var(--logo-size) + 2px);
  display:flex;align-items:center;justify-content:center;overflow:hidden;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
}
.logo-circle img{width:var(--logo-size);height:var(--logo-size);border-radius:50%;object-fit:cover}

/* ---------- City tabs ---------- */
.city-tabs{border-bottom:1px solid var(--border);padding:12px 16px;max-width:var(--max);margin:0 auto;
  display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
.city-tabs button{padding:8px 14px;border:1px solid var(--border);background:#fff;border-radius:999px;cursor:pointer}
.city-tabs button[aria-pressed="true"]{background:var(--brand);color:#fff;border-color:var(--brand)}

/* ---------- Layout ---------- */
.page{
  max-width:var(--max);
  margin:24px auto;
  padding:0 16px;
  display:grid;
  grid-template-columns:1fr 320px;
  gap:24px;
}

/* Masonry под ленту: 3 колонки на десктопе */
.feed{
  column-count:3;
  column-gap:16px;
}
.feed > *{
  break-inside:avoid;
  -webkit-column-break-inside:avoid;
  margin-bottom:16px;
  width:100%;
  display:block;
}

@media (min-width:981px){
  .sidebar{display:none}
  .page{grid-template-columns:1fr}
}

/* Планшет: 2 колонки */
@media (max-width:980px){
  .page{grid-template-columns:1fr}
  .feed{column-count:2}
}
/* Мобила: 2 колонки */
@media (max-width:600px){
  .feed{column-count:2; column-gap:12px;}
}

.card{border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;background:#fff}

/* ---------- Gallery ---------- */
.card__media{aspect-ratio:4 / 5;background:#f3f4f6;position:relative;border-bottom:1px solid var(--border);overflow:hidden}
.gallery{width:100%;height:100%;position:relative;user-select:none;touch-action:pan-y}
.gallery__viewport{width:100%;height:100%;overflow:hidden}
.gallery__track{height:100%;display:flex;transition:transform .35s ease;will-change:transform}
.slide{min-width:100%;height:100%;position:relative;overflow:hidden;background:#eee}
.slide > img,.slide > picture > img,.slide > video,.slide > iframe{width:100%;height:100%;object-fit:cover;display:block;border:0}

.gallery__arrow{position:absolute;top:50%;transform:translateY(-50%);width:36px;height:36px;border-radius:999px;display:grid;place-items:center;background:rgba(255,255,255,.32);border:1px solid rgba(0,0,0,.06);-webkit-backdrop-filter:saturate(1.1) blur(10px);backdrop-filter:saturate(1.1) blur(10px);box-shadow:0 4px 12px rgba(0,0,0,.12);color:#0b0b0b;cursor:pointer}
.gallery__arrow:hover{background:rgba(255,255,255,.42)}
.gallery__arrow--prev{left:10px}
.gallery__arrow--next{right:10px}
.gallery__dots{position:absolute;left:50%;bottom:10px;transform:translateX(-50%);display:flex;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.24);border:1px solid rgba(0,0,0,.06);-webkit-backdrop-filter:saturate(1.1) blur(8px);backdrop-filter:saturate(1.1) blur(8px);box-shadow:0 4px 10px rgba(0,0,0,.08)}
.gallery__dot{width:8px;height:8px;border-radius:50%;background:rgba(0,0,0,.25);border:0;cursor:pointer;padding:0}
.gallery__dot[aria-current="true"]{background:#0a0a0a}
.card__body{padding:14px 16px}
.card__kicker{font-size:12px;letter-spacing:.06em;color:var(--muted);text-transform:uppercase}
.card__title{margin:6px 0 8px;font-size:20px;line-height:1.3}
.card__meta{display:flex;gap:12px;color:var(--muted);font-size:14px}

.sidebar{display:grid;gap:16px}
.slot__label{color:var(--muted);font-size:14px}

.footer{border-top:1px solid var(--border);margin-top:32px}
.footer__inner{max-width:var(--max);margin:0 auto;padding:20px 16px;color:var(--muted);font-size:14px;display:flex;justify-content:space-between;gap:16px;flex-wrap:wrap}

@supports not ((backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px))){
  .topbar{background:rgba(255,255,255,.9)}
  .glass-btn{background:rgba(255,255,255,.98);border-color:rgba(0,0,0,.08)}
}

/* Промо-слот — базовая */
.s-card{display:block;border-radius:16px;overflow:hidden;text-decoration:none;color:inherit;background:#fff;border:1px solid var(--border);box-shadow:0 4px 12px rgba(0,0,0,.08)}
.s-card__media{aspect-ratio:4 / 3;background:#f3f4f6}
.s-card__media img{width:100%;height:100%;object-fit:cover;display:block}
.s-card__body{padding:12px 14px}
.s-card__title{font-size:16px;font-weight:700;margin:0 0 6px}
.s-card__meta{font-size:13px;color:var(--muted);margin-bottom:10px}
.s-card__btn{display:inline-block;font-size:13px;font-weight:600;padding:8px 12px;border-radius:999px;background:rgba(0,0,0,.04)}
.s-card__btn:hover{background:rgba(0,0,0,.08)}

/* Итог: пунктирная рамка + внутренний отступ 10px */
.slot--masonry,
.slot--inline{
  display:block;
  padding:10px;
  border:1px dashed var(--border);
  border-radius:var(--radius);
  background:#fff;
  overflow:hidden;
  box-sizing:border-box;
}
.slot--masonry{margin-bottom:16px;}
.slot--inline{margin:0;}
.slot--masonry .s-card,
.slot--inline .s-card{
  border:none;
  border-radius:calc(var(--radius) - 2px);
  box-shadow:0 2px 16px rgba(255, 206, 212, 1);
}
@media (min-width:981px){
  .slot--masonry .s-card__body{padding:10px 12px}
  .slot--masonry .s-card__title{font-size:15px}
  .slot--masonry .s-card__meta{font-size:12px;margin-bottom:8px}
  .slot--masonry .s-card__btn{font-size:12px;padding:6px 10px}
}

  </style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="topbar__inner">
    <div class="topbar__left">
      <a class="glass-btn" href="https://t.me/kuda_namylilis" target="_blank">
        <img class="tg-ic" src="https://uxwing.com/wp-content/themes/uxwing/download/brands-and-social-media/telegram-black-icon.png" alt="Telegram">
        <span>Мы в Telegram</span>
      </a>
    </div>
    <div class="topbar__center">
      <a href="#" class="logo-circle"><img src="logo.jpeg" alt="Куда намылились"></a>
    </div>
    <nav class="topbar__right">
      <a href="#" class="glass-btn" aria-current="page">Афиша</a>
      <a href="#" class="glass-btn">Заведения</a>
      <a href="#" class="glass-btn">Места</a>
    </nav>
  </div>
</div>

<!-- Города -->
<div class="city-tabs">
  <button type="button" aria-pressed="true">Анапа</button>
  <button type="button">Геленджик</button>
  <button type="button">Новороссийск</button>
</div>

<!-- Контент -->
<main class="page">
  <section class="feed" id="feed"></section>

  <aside class="sidebar" aria-label="Сайдбар">
    <div class="slot">
      <div class="slot__label">
        <a class="s-card"
           href="https://yandex.ru/maps/org/kofe_leto/217951965397/?ll=37.326749%2C44.882456&z=13"
           target="_blank" rel="noopener" aria-label="Кофейня «Кофе Лето» — открыть на Яндекс Картах">
          <div class="s-card__media">
            <img src="https://avatars.mds.yandex.net/get-altay/3511135/2a0000017825bfa0163863bb3e32748ce949/XXXL" alt="Кофе Лето — кофейня, витрина и напитки">
          </div>
          <div class="s-card__body">
            <div class="s-card__title">Кофе Лето — уютная кофейня рядом</div>
            <div class="s-card__meta">Кофе • Десерты • To&nbsp;Go</div>
            <div class="s-card__btn">Открыть в Яндекс Картах</div>
          </div>
        </a>
      </div>
    </div>
    <div class="slot">
      <div class="slot__label">
        <a class="s-card" href="https://5verst.ru/plyazh40letpobedy/" target="_blank" rel="noopener" aria-label="5 ВЁРСТ АНАПА — сайт">
          <div class="s-card__media">
            <img src="https://5verst.ru/plyazh40letpobedy/wp-content/uploads/sites/179/2024/09/x1g9PEm7ij-Naf1sNQSwzsaDINEfF1_jvijro3KUmuY2Qk0zhKahT5DbWy9olq1ekJmD7uc3UEmtnnRiR8BLH28e-2048x1536.webp" alt="5 ВЁРСТ АНАПА">
          </div>
          <div class="s-card__body">
            <div class="s-card__title">5 ВЁРСТ АНАПА</div>
            <div class="s-card__meta">Бесплатные старты на 5 км по субботам</div>
            <div class="s-card__btn">Подробнее</div>
          </div>
        </a>
      </div>
    </div>
    <div class="slot">
      <div class="slot__label">
        <a class="s-card" href="https://t.me/wherelera" target="_blank" rel="noopener" aria-label="Креативный дизайн — Телеграм">
          <div class="s-card__media">
            <img src="murz.png" alt="Креативный дизайн">
          </div>
          <div class="s-card__body">
            <div class="s-card__title">Креативный дизайн</div>
            <div class="s-card__meta">Айдентика • Вёрстка • SMM</div>
            <div class="s-card__btn">Заказать</div>
          </div>
        </a>
      </div>
    </div>
  </aside>
</main>

<footer class="footer">
  <div class="footer__inner">
    <div>© <span id="y"></span> «Куда намылились»</div>
    <div><a href="#">Реклама</a> · <a href="#">Правила</a> · <a href="#">Контакты</a></div>
  </div>
</footer>

<template id="post-card">
  <article class="card">
    <div class="card__media">
      <div class="gallery" data-start="0">
        <div class="gallery__viewport"><div class="gallery__track"></div></div>
        <button class="gallery__arrow gallery__arrow--prev">‹</button>
        <button class="gallery__arrow gallery__arrow--next">›</button>
        <div class="gallery__dots"></div>
      </div>
    </div>
    <div class="card__body">
      <div class="card__kicker">Афиша • Юг</div>
      <h2 class="card__title"><a href="#" target="_blank"></a></h2>
      <div class="card__meta"></div>
    </div>
  </article>
</template>

<script>
/* ====== Utils ====== */
const $  = (sel, root=document) => root.querySelector(sel);
const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

const RU_DATE = new Intl.DateTimeFormat('ru-RU',{day:'2-digit',month:'2-digit',year:'numeric'});
const MEDIA_BASE = 'media/';
const CHANNEL = 'kuda_namylilis';
const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;

/* ====== Footer year ====== */
$('#y').textContent = new Date().getFullYear();

/* ====== Boot ====== */
document.addEventListener('DOMContentLoaded', () => {
  hydrateCityTabs();
  loadPosts()
    .then(() => { initGalleries(); mixAdsMasonry(); })
    .catch(err => console.error('Загрузка ленты сорвалась', err));
});

/* ====== City tabs (как было, но компактнее) ====== */
function hydrateCityTabs(){
  const tabs = $$('.city-tabs button');
  if (!tabs.length) return;
  tabs.forEach(btn => btn.addEventListener('click', () => {
    tabs.forEach(b => b.setAttribute('aria-pressed','false'));
    btn.setAttribute('aria-pressed','true');
  }, {passive:true}));
}

/* ====== Posts ====== */
async function loadPosts(){
  const feed = $('#feed');
  const tpl  = $('#post-card');
  if (!feed || !tpl) return;

  let posts;
  const ctrl = new AbortController();
  try{
    const res = await fetch('posts.json', {cache:'no-store', signal: ctrl.signal});
    if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
    posts = await res.json();
  }catch(e){
    console.error('Не удалось загрузить posts.json', e);
    return;
  }

  if (!Array.isArray(posts) || posts.length === 0) return;

  posts.sort((a,b) => (b?.id||0) - (a?.id||0));

  const frag = document.createDocumentFragment();
  for (const p of posts){
    if (!p || !Array.isArray(p.media) || p.media.length === 0 || typeof p.text !== 'string') continue;

    const node = tpl.content.cloneNode(true);
    const link = `https://t.me/${CHANNEL}/${p.id}`;
    const firstLine = (p.text.split('\n')[0] || '').trim() || `Пост #${p.id}`;

    const aTitle = $('.card__title a', node);
    aTitle.textContent = firstLine;
    aTitle.href = link;
    $('.card__meta', node).textContent = RU_DATE.format(new Date(p.date || Date.now()));

    const track = $('.gallery__track', node);
    const dots  = $('.gallery__dots',  node);
    const prev  = $('.gallery__arrow--prev', node);
    const next  = $('.gallery__arrow--next', node);

    for (let i=0;i<p.media.length;i++){
      const m = String(p.media[i]||'');
      if (!m) continue;

      const slide = document.createElement('div');
      slide.className = 'slide';
      slide.setAttribute('role','group');
      slide.setAttribute('aria-roledescription','slide');
      slide.setAttribute('aria-label', `${i+1} из ${p.media.length}`);

      if (/\.(mp4|webm|mov)$/i.test(m)){
        const video = document.createElement('video');
        video.autoplay = true; video.muted = true; video.loop = true; video.playsInline = true; video.preload = 'metadata';
        const src = document.createElement('source');
        src.src = MEDIA_BASE + m;
        src.type = inferVideoType(m);
        video.appendChild(src);
        slide.appendChild(video);
      } else {
        const img = document.createElement('img');
        img.src = MEDIA_BASE + m;
        img.loading = 'lazy';
        img.decoding = 'async';
        img.width = 1080; img.height = 1350;
        img.alt = `${firstLine} — ${m}`;
        slide.appendChild(img);
      }

      track.appendChild(slide);

      const dot = document.createElement('button');
      dot.className = 'gallery__dot';
      dot.type = 'button';
      dot.setAttribute('aria-label', `Слайд ${i+1}`);
      dots.appendChild(dot);
    }

    if (p.media.length < 2){
      prev.style.display = 'none';
      next.style.display = 'none';
      dots.style.display = 'none';
    }

    frag.appendChild(node);
  }

  feed.appendChild(frag);
}

/* ====== Gallery (pointer events + rAF) ====== */
function initGalleries(){
  const galleries = $$('.gallery');
  for (const gallery of galleries){
    const viewport = $('.gallery__viewport', gallery);
    const track    = $('.gallery__track', gallery);
    const slides   = $$('.slide', track);
    const prevBtn  = $('.gallery__arrow--prev', gallery);
    const nextBtn  = $('.gallery__arrow--next', gallery);
    const dotsWrap = $('.gallery__dots', gallery);
    if (!viewport || !track || slides.length === 0) continue;

    if (slides.length < 2){
      if (prevBtn) prevBtn.style.display='none';
      if (nextBtn) nextBtn.style.display='none';
      if (dotsWrap) dotsWrap.style.display='none';
      track.style.transform='translateX(0%)';
      continue;
    }

    const startIndex = clamp(parseInt(gallery.getAttribute('data-start')||'0',10), 0, slides.length-1);
    let index = startIndex;
    let dragging = false;
    let startX = 0, dx = 0;
    let raf = 0;

    buildDots(dotsWrap, slides.length, (i)=>goTo(i));
    gallery.setAttribute('tabindex','0');
    gallery.addEventListener('keydown', (e)=>{
      if (e.key === 'ArrowLeft')  goTo(index-1);
      if (e.key === 'ArrowRight') goTo(index+1);
    }, {passive:true});

    if (prevBtn) prevBtn.addEventListener('click', ()=>goTo(index-1));
    if (nextBtn) nextBtn.addEventListener('click', ()=>goTo(index+1));

    viewport.addEventListener('pointerdown', onDown, {passive:true});
    viewport.addEventListener('pointercancel', onUp, {passive:true});
    viewport.addEventListener('pointerleave', onUp, {passive:true});

    function onDown(e){
      if (prefersReduced) return;
      dragging = true;
      startX = e.clientX;
      dx = 0;
      track.style.transition = 'none';
      viewport.setPointerCapture(e.pointerId);
      window.addEventListener('pointermove', onMove, {passive:true});
      window.addEventListener('pointerup', onUp,   {once:true, passive:true});
    }
    function onMove(e){
      if (!dragging) return;
      dx = e.clientX - startX;
      if (!raf) raf = requestAnimationFrame(updateDrag);
    }
    function updateDrag(){
      raf = 0;
      const w = viewport.clientWidth || 1;
      const p = (dx / w) * 100;
      track.style.transform = `translateX(calc(${-100*index}% + ${p}%))`;
    }
    function onUp(){
      if (!dragging) return;
      dragging = false;
      track.style.transition = '';
      const w = viewport.clientWidth || 1;
      if (Math.abs(dx) > w * 0.15){
        if (dx < 0) goTo(index+1); else goTo(index-1);
      } else {
        goTo(index);
      }
      window.removeEventListener('pointermove', onMove, {passive:true});
    }

    function goTo(i){
      index = clamp(i, 0, slides.length-1);
      track.style.transform = `translateX(${-100*index}%)`;
      pauseAllExcept(slides, index);
      updateDots(dotsWrap, index);
    }

    goTo(startIndex);
  }
}

function buildDots(wrap, count, onClick){
  if (!wrap) return;
  wrap.innerHTML = '';
  for (let i=0;i<count;i++){
    const b = document.createElement('button');
    b.className = 'gallery__dot';
    b.type = 'button';
    b.setAttribute('aria-label', `Слайд ${i+1}`);
    b.addEventListener('click', ()=>onClick(i));
    wrap.appendChild(b);
  }
}

function updateDots(wrap, active){
  if (!wrap) return;
  $$('.gallery__dot', wrap).forEach((d,i)=>{
    if (i===active) d.setAttribute('aria-current','true');
    else d.removeAttribute('aria-current');
  });
}

function pauseAllExcept(slides, iKeep){
  for (let i=0;i<slides.length;i++){
    const v = $('video', slides[i]);
    if (!v) continue;
    if (i===iKeep) v.play?.(); else v.pause?.();
  }
}

/* ====== Ads mixing: детерминированная врезка ====== */
/* Схема: после каждых 4 карточек вставляется один слот, затем шаг 5, затем снова 4, и так по кругу.
   Внешний вид прежний: slot получает класс .slot--masonry. */
function mixAdsMasonry(){
  const feed = $('#feed');
  const sidebar = $('.sidebar');
  if (!feed || !sidebar) return;

  const cards = $$('.card', feed);
  const adsSrc = $$('.slot', sidebar);
  if (!cards.length || !adsSrc.length) return;

  const plan = cycle([4,5]); // шаги между врезками
  let nextBreak = plan.next().value;

  const result = [];
  let taken = 0, adIndex = 0;

  for (let i=0;i<cards.length;i++){
    result.push(cards[i]);
    taken++;
    if (taken === nextBreak && adIndex < adsSrc.length){
      const slot = adsSrc[adIndex++];
      slot.classList.add('slot--masonry');
      result.push(slot);
      taken = 0;
      nextBreak = plan.next().value;
    }
  }
  // хвостовые слоты (если остались)
  while (adIndex < adsSrc.length){
    const slot = adsSrc[adIndex++];
    slot.classList.add('slot--masonry');
    result.push(slot);
  }

  // Перестройка DOM за один проход
  feed.innerHTML = '';
  const frag = document.createDocumentFragment();
  for (const n of result) frag.appendChild(n);
  feed.appendChild(frag);
}

/* ====== Helpers ====== */
function clamp(n, min, max){ return n < min ? min : n > max ? max : n; }
function cycle(arr){
  let i = 0;
  return {
    next(){ const v = arr[i]; i = (i+1) % arr.length; return {value:v, done:false}; }
  };
}
function inferVideoType(name){
  const ext = name.split('.').pop()?.toLowerCase();
  if (ext === 'mp4')  return 'video/mp4';
  if (ext === 'webm') return 'video/webm';
  if (ext === 'mov')  return 'video/quicktime';
  return 'video/mp4';
}
</script>


</body>
</html>
